{"path":".obsidian/plugins/text-extractor/cache/rb/excalidraw-rbc-rbc-21854-capture-1-png-c3e63546d655b25131a706d8b73ad44e.json","text":"—‘Insert into #BlocksToReallocate(BlockID, BlockStartDate, BlockEndDate) | select distinct b.blockid, b.FromDt, b.ToDt --accounts dropped but are not correct in the allocation table | from retail.blu.tbl_block_info b (nolock) | join retail.blu.tbl_block_info_acnt a (nolock) on a.blockID = b.blockID | join retail.dbo.tbl_acnt_period ap (nolock) on ap.acnt_id = a.acntID | join retail.blu.tbl_load_ratio_method 1 (nolock) on b.loadRatioMethodID = 1.LoadRatioMethodID | left join retail.blu.tbl_block_info_acnt_allocation baa (nolock) on baa.blockID = b.blockID and baa.acntID = a.acntID : and convert(date, isnull(baa.EndDate, '1/1/1900')) = convert(date, dateadd(day, -1, ap.to_dt)) and baa.Active = 1 ' |where convert(date, ap.to_dt) between b.FromDt and dateadd(minute, -1, b.ToDt) ' |and 1.LoadRatioMethodName - 'Fixed Reallocate’ and ap.to_dt > dateadd(month, -6, getdate()) |and baa.blockID is null ~ |and a.Assigned = 1 ~ |and b.Active = 1 | |and not exists ( : select 'x' from bil.tbl_invoice i (nolock) ‘ join bil.tbl_invoice_detail d (nolock) on i.invoiceid=d.invoiceid ‘, where i.invoice_status_id in (1,2,4,5,7) \\ and blockid = b.BlockID » and i.todt > ap.to_dt) --make sure we didn't already generate a bill UNION | select distinct b.blockid, b.FromDt, b.ToDt --accounts were added but are not correct in the allocation table | from retail.blu.tbl_block_info b (nolock) | join retail.blu.tbl_block_info_acnt a (nolock) on a.blockID = b.blockID | join retail.dbo.tbl_acnt_period ap (nolock) on ap.acnt_id = a.acntID | join retail.blu.tbl_load_ratio_method 1 (nolock) on b.loadRatioMethodID = 1.LoadRatioMethodID | left join retail.blu.tbl_block_info_acnt_allocation baa (nolock) on baa.blockID = b.blockID and baa.acntID = a.acntID ; and convert(date, isnull(baa.StartDate, '1/1/1900')) = convert(date, ap.from_dt) and baa.Active = 1 ' |where convert(date, ap.from_dt) between b.FromDt and dateadd(minute, -1, b.toDt) | and 1.LoadRatioMethodName - 'Fixed Reallocate' and ap.from_dt > dateadd(month, -6, getdate()) |and baa.blockID is null ~ |and a.Assigned = 1 ~ |and b.Active = 1 | |and not exists ( » select 'x' from bil.tbl_invoice i (nolock) ‘ join bil.tbl_invoice_detail d (nolock) on i.invoiceid=d.invoiceid : where i.invoice_status_id in (1,2,4,5,7) \\ and blockid = b.BlockID b and i.todt > ap.from_dt) UNION | select distinct bia.blockID, b.FromDt, b.ToDt --account(s) dropped prior to the block start but account is in the allocation table | from retail.blu.tbl_block_info_acnt_allocation bia (nolock) | join retail.blu.tbl_block_info b (nolock) on b.blockID = bia.blockID | join retail.blu.tbl_load_ratio_method 1 (nolock) on b.loadRatioMethodID = 1.LoadRatioMethodID |where bia.Active = 1 |and b.Active = 1 | and 1.LoadRatioMethodName - 'Fixed Reallocate’ |and bia.blockID > @ ' |and (select max(to_dt) from retail.dbo.tbl_acnt_period ap (nolock) where ap.acnt_Id - bia.acntid) < bia.StartDate and not exists ( ‘ select 'x' from bil.tbl_invoice i (nolock) join bil.tbl_invoice_detail d (nolock) on i.invoiceid=d.invoiceid : where i.invoice_status_id in (1,2,4,5,7) » —‘ and blockid = bia.BlockID) --make sure we didn't already generate a bill","libVersion":"0.0.0","langs":"eng","hash":"","size":0}