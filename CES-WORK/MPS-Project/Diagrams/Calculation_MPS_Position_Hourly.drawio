<mxGraphModel dx="5175" dy="2355" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0"><root><mxCell id="0"/><mxCell id="1" parent="0"/><mxCell id="YOlnXGKY-DtFsy2RqCuO-1" value="MPS_Position_Hourly" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=16;" parent="1" vertex="1"><mxGeometry x="20" y="150" width="240" height="30" as="geometry"/></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-2" value="Start" style="text;html=1;strokeColor=#666666;fillColor=#f5f5f5;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontColor=#333333;" parent="1" vertex="1"><mxGeometry x="252.5" y="200" width="60" height="30" as="geometry"/></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-3" value="Provide inputs - Company Names, Start Date and End Date" style="text;html=1;strokeColor=#6c8ebf;fillColor=#dae8fc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1"><mxGeometry x="112.5" y="250" width="350" height="30" as="geometry"/></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-4" value="Delete the records for the Company in the table MPS_Position_Hourly" style="text;html=1;strokeColor=#6c8ebf;fillColor=#dae8fc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1"><mxGeometry x="90" y="300" width="395" height="30" as="geometry"/></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-5" value="Get all the Porfolio of the Company" style="text;html=1;strokeColor=#6c8ebf;fillColor=#dae8fc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1"><mxGeometry x="90" y="350" width="395" height="30" as="geometry"/></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-6" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Verdana;align=left;" parent="1" vertex="1"><mxGeometry x="80" y="400" width="432.5" height="80" as="geometry"/></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-10" value="(1) LoadMWh" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontFamily=Verdana;" parent="1" vertex="1"><mxGeometry x="90.5" y="400" width="129.5" height="30" as="geometry"/></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-11" value="Between StartDate and EndDate (incl both dates) for end HourEnding - get the LoadMWh for all Portfolios" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;fontFamily=Verdana;" parent="1" vertex="1"><mxGeometry x="97.25" y="430" width="406.25" height="40" as="geometry"/></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-12" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Verdana;align=left;" parent="1" vertex="1"><mxGeometry x="80" y="510" width="432.5" height="90" as="geometry"/></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-13" value="HedgeMWh and Cost" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontFamily=Verdana;" parent="1" vertex="1"><mxGeometry x="90.5" y="510" width="151.5" height="30" as="geometry"/></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-14" value="Between StartDate and EndDate (incl both dates) for end HourEnding - get the HedgeData and Cost&lt;br&gt;&amp;nbsp;for all Porfolios" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;fontFamily=Verdana;" parent="1" vertex="1"><mxGeometry x="97.87" y="540" width="405.75" height="50" as="geometry"/></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-32" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="YOlnXGKY-DtFsy2RqCuO-15" target="YOlnXGKY-DtFsy2RqCuO-18" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-15" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Verdana;align=left;" parent="1" vertex="1"><mxGeometry x="80" y="620" width="432.5" height="100" as="geometry"/></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-16" value="Handle DST" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontFamily=Verdana;" parent="1" vertex="1"><mxGeometry x="90.5" y="620" width="81" height="30" as="geometry"/></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-17" value="Between StartDate and EndDate (incl both dates) for &lt;b&gt;ONLY &lt;/b&gt;DST HEs&amp;nbsp;- recalculate HedgeMWh = HedgeMWh/2, Cost =Cost/2" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;fontFamily=Verdana;" parent="1" vertex="1"><mxGeometry x="96.25" y="650" width="407.37" height="30" as="geometry"/></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-33" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="YOlnXGKY-DtFsy2RqCuO-18" target="YOlnXGKY-DtFsy2RqCuO-23" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-18" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontFamily=Verdana;align=left;" parent="1" vertex="1"><mxGeometry x="80" y="750" width="432.5" height="90" as="geometry"/></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-19" value="NOPMWh" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontFamily=Verdana;" parent="1" vertex="1"><mxGeometry x="90.5" y="750" width="60" height="30" as="geometry"/></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-20" value="Between StartDate and EndDate (incl both dates) for end HourEnding for all Portfolios - calculate NOPMWh as LoadMWh - HedgeMWh" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;fontFamily=Verdana;" parent="1" vertex="1"><mxGeometry x="96.25" y="780" width="407.37" height="50" as="geometry"/></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-21" value="Duplicate the records for DST HE" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;fontFamily=Verdana;" parent="1" vertex="1"><mxGeometry x="98.37" y="690" width="405.25" height="20" as="geometry"/></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-23" value="End" style="text;html=1;strokeColor=#666666;fillColor=#f5f5f5;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontColor=#333333;" parent="1" vertex="1"><mxGeometry x="266.25" y="870" width="60" height="30" as="geometry"/></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-25" value="&lt;h4&gt;&lt;span style=&quot;font-weight: normal;&quot;&gt;&lt;span&gt;Use table&lt;br&gt;&lt;/span&gt;&lt;span&gt;- [MPS_LoadForeCastData_Interval]&lt;br&gt;&lt;/span&gt;&lt;span&gt;- MPS_Portfolio&lt;/span&gt;&lt;/span&gt;&lt;/h4&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=3" parent="1" vertex="1"><mxGeometry x="562.5" y="365" width="250" height="75" as="geometry"/></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-26" value="" style="endArrow=none;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="YOlnXGKY-DtFsy2RqCuO-11" target="YOlnXGKY-DtFsy2RqCuO-25" edge="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="382.5" y="530" as="sourcePoint"/><mxPoint x="432.5" y="480" as="targetPoint"/></mxGeometry></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-27" value="" style="endArrow=classic;html=1;rounded=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="YOlnXGKY-DtFsy2RqCuO-3" target="YOlnXGKY-DtFsy2RqCuO-4" edge="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="392.5" y="290" as="sourcePoint"/><mxPoint x="442.5" y="240" as="targetPoint"/></mxGeometry></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-28" value="" style="endArrow=classic;html=1;rounded=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="YOlnXGKY-DtFsy2RqCuO-4" target="YOlnXGKY-DtFsy2RqCuO-5" edge="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="297.5" y="290" as="sourcePoint"/><mxPoint x="297.5" y="310" as="targetPoint"/></mxGeometry></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-29" value="" style="endArrow=classic;html=1;rounded=0;entryX=0.487;entryY=-0.001;entryDx=0;entryDy=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryPerimeter=0;" parent="1" source="YOlnXGKY-DtFsy2RqCuO-5" target="YOlnXGKY-DtFsy2RqCuO-6" edge="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="307.5" y="300" as="sourcePoint"/><mxPoint x="307.5" y="320" as="targetPoint"/></mxGeometry></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-30" value="" style="endArrow=classic;html=1;rounded=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="YOlnXGKY-DtFsy2RqCuO-6" target="YOlnXGKY-DtFsy2RqCuO-12" edge="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="317.5" y="310" as="sourcePoint"/><mxPoint x="317.5" y="330" as="targetPoint"/></mxGeometry></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-31" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="YOlnXGKY-DtFsy2RqCuO-12" edge="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="232.5" y="770" as="sourcePoint"/><mxPoint x="296.5" y="630" as="targetPoint"/></mxGeometry></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-34" value="Use table &lt;font color=&quot;#6666ff&quot;&gt;MPS_HedgeData_Interval_SrcMktLoc &lt;/font&gt;-the data in this table saved at hourly level for a Portfolio by &lt;font color=&quot;#b5739d&quot;&gt;DeliverZoneID &lt;/font&gt;and &lt;font color=&quot;#b5739d&quot;&gt;FinPhys&lt;/font&gt;. This needs to be rolled up at hourly level for a Porfolio" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=2" parent="1" vertex="1"><mxGeometry x="567.5" y="490" width="240" height="110" as="geometry"/></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-36" value="&lt;div&gt;Note to Dev Team&lt;/div&gt;&lt;div&gt;In Step 5.1 if using GROUP BY to roll up the&lt;/div&gt;&lt;div&gt;numbers then do this.&lt;/div&gt;&lt;div&gt;Ref table&lt;/div&gt;&lt;div&gt;For HE3 in March there should O records-&lt;/div&gt;&lt;div&gt;For HE2 in Nov there should be 2 records&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=2" parent="1" vertex="1"><mxGeometry x="567.5" y="610" width="240" height="110" as="geometry"/></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-37" value="" style="endArrow=none;html=1;rounded=0;exitX=1;exitY=1;exitDx=0;exitDy=0;" parent="1" source="YOlnXGKY-DtFsy2RqCuO-17" edge="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="522.5" y="710" as="sourcePoint"/><mxPoint x="572.5" y="660" as="targetPoint"/></mxGeometry></mxCell><mxCell id="YOlnXGKY-DtFsy2RqCuO-40" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="YOlnXGKY-DtFsy2RqCuO-2" target="YOlnXGKY-DtFsy2RqCuO-3" edge="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="382.5" y="430" as="sourcePoint"/><mxPoint x="432.5" y="380" as="targetPoint"/></mxGeometry></mxCell><mxCell id="29jnx2Jy7FXrF2WolndV-3" value="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1"><mxGeometry x="-760" y="90" width="20" height="20" as="geometry"/></mxCell><mxCell id="29jnx2Jy7FXrF2WolndV-4" value="--SELECT s.PositionSegmentZoneID,s.PositionSegmentZone,p.ProductType_ID,p.ProductType,z.ZoneID,z.MktLocationName&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp;--INTO #ListA&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp;--FROM [dbo].[MPS_ProductType] p&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp;--CROSS JOIN [dbo].[MPS_PositionSegmentZone] s&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp;--JOIN MPS_Zone z ON z.use market_services&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;select * from mps_company&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;exec sp_helptext 'usp_MPS_Position_Hourly'&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;--09/02/2021 MPS-43 Process for calculating and saving Position data at Hourly level&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;--09/08/2021&amp;nbsp; &amp;nbsp; MPS-43 Fixing the If Exists&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;--10/12/2022 MPS-103 Adding LoadMWh to DST calculation&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;CREATE PROC [dbo].[usp_MPS_Position_Hourly]&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;--1.0&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;@Company INT,&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;@StartDate DATE,&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;@EndDate DATE&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;AS&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;BEGIN&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;IF NOT EXISTS(SELECT TOP 1 'x' FROM dbo.MPS_Company WHERE CompanyID = @Company)&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;RETURN;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;IF @StartDate &amp;gt; @EndDate&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;RETURN;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;IF OBJECT_ID('TempDB..#ListA') IS NOT NULL&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;DROP TABLE #ListA&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;--2.0&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;--MPS-101 drop PositionSegmentZoneID, so commented out this statement&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;--SELECT s.PositionSegmentZoneID,s.PositionSegmentZone,p.ProductType_ID,p.ProductType,z.ZoneID,z.MktLocationName&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;--INTO #ListA&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;--FROM [dbo].[MPS_ProductType] p&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;--CROSS JOIN [dbo].[MPS_PositionSegmentZone] s&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;--JOIN MPS_Zone z ON z.PositionSegmentZoneID = s.PositionSegmentZoneID&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;IF NOT EXISTS(SELECT TOP 1 'x' FROM #ListA)&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;RETURN;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;--1.2&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;DELETE FROM dbo.MPS_Position_Hourly WHERE Company = @Company&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;CREATE TABLE #temp_Position_Hourly&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;(&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; [Company] [int],&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; [PositionSegmentZone] [int],&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; [ProductType] [int],&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; [Date] [date],&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; [HourEnding] [int],&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; [LoadMWh] [decimal](9, 3),&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; [ZoneHedgeMWh] [decimal](9, 3),&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; [HubHedgeMWh] [decimal](9, 3),&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; [ZoneHedgeCost] [decimal](9, 2),&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; [HubHedgeCost] [decimal](9, 2)&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;)&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;CREATE TABLE #MPS_Position_Hourly&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;(&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; [Company] [int],&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; [PositionSegmentZone] [int],&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; [ProductType] [int],&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; [Date] [date],&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; [HourEnding] [int],&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; [LoadMWh] [decimal](9, 3),&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; [ZoneHedgeMWh] [decimal](9, 3),&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; [HubHedgeMWh] [decimal](9, 3),&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; [TotalHedgeMWh] [decimal](9, 3),&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; [NOPMWh] [decimal](9, 3),&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; [ZoneHedgeCost] [decimal](9, 2),&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; [HubHedgeCost] [decimal](9, 2),&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; [TotalHedgeCost] [decimal](9, 2)&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;)&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;WHILE EXISTS(SELECT TOP 1 'x' FROM #ListA)&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;BEGIN&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; DECLARE @ProductType INT , @LoadZone INT , @HourEnding INT&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; SELECT TOP 1 @ProductType = ProductType_ID ,@LoadZone = ZoneID FROM #ListA&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; SET @HourEnding = 1&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; WHILE(@HourEnding &amp;lt;= 24)&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; BEGIN&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;--4.0&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;INSERT INTO #temp_Position_Hourly(Company,PositionSegmentZone,ProductType,[Date],HourEnding,LoadMWh)&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;SELECT l.CompanyID,a.PositionSegmentZoneID,l.ProductType,l.[Date],l.HourEnding,ISNULL(Load_MW,0)&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;FROM dbo.MPS_LoadForecastData_Interval l&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;JOIN #ListA a ON a.ProductType_ID = l.ProductType AND a.ZoneID = l.LoadZone&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;WHERE l.CompanyID = @Company&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;AND l.ProductType = @ProductType&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;AND l.LoadZone = @LoadZone&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;AND l.[Date] BETWEEN @StartDate AND @EndDate&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;AND l.HourEnding = @HourEnding&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;--5.0 &amp;amp; 6.0&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;INSERT INTO #temp_Position_Hourly(Company,PositionSegmentZone,ProductType,[Date],HourEnding,LoadMWh,ZoneHedgeMWh,HubHedgeMWh,ZoneHedgeCost,HubHedgeCost)&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;SELECT i.[CompanyID],a.PositionSegmentZoneID,i.ProductType,i.[Date],i.HourEnding,0,&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; CASE WHEN a.ZoneName like 'LZ_%' THEN ISNULL(i.[HedgeMW],0) ELSE 0 END AS ZoneHedgeMWh,&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; CASE WHEN a.ZoneName like 'HB_%' THEN ISNULL(i.[HedgeMW],0) ELSE 0 END AS HubHedgeMWh,&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; CASE WHEN a.ZoneName like 'LZ_%' THEN ISNULL(i.Cost,0) ELSE 0 END AS ZoneHedgeCost,&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; CASE WHEN a.ZoneName like 'HB_%' THEN ISNULL(i.Cost,0) ELSE 0 END AS HubHedgeCost&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; FROM dbo.MPS_HedgeData_Interval i&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; JOIN #ListA a ON a.ProductType_ID = i.ProductType AND a.ZoneID = [DeliveryZoneID]&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; WHERE i.[CompanyID] = @Company&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; AND i.ProductType = @ProductType&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; AND i.[DeliveryZoneID] = @LoadZone&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; AND i.[Date] BETWEEN @StartDate AND @EndDate&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; AND i.HourEnding = @HourEnding&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;SET @HourEnding = @HourEnding + 1&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; END&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; DELETE FROM #ListA WHERE ProductType_ID = @ProductType AND ZoneID = @LoadZone&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;END&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;INSERT INTO #MPS_Position_Hourly(Company,PositionSegmentZone,ProductType,[Date],HourEnding,LoadMWh,ZoneHedgeMWh,HubHedgeMWh,ZoneHedgeCost,HubHedgeCost,TotalHedgeMWh,TotalHedgeCost,NOPMWh)&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;SELECT Company,PositionSegmentZone,ProductType,[Date],HourEnding,SUM(LoadMWh),SUM(ISNULL(ZoneHedgeMWh,0)) AS ZoneHedgeMWh,SUM(ISNULL(HubHedgeMWh,0)) AS HubHedgeMWh,SUM(ISNULL(ZoneHedgeCost,0)) AS ZoneHedgeCost,SUM(ISNULL(HubHedgeCost,0)) AS HubHedgeCost,&lt;/div&gt;&lt;div&gt;0,0,0&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;FROM #temp_Position_Hourly&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;GROUP BY Company,PositionSegmentZone,ProductType,[Date],HourEnding&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;--7.0&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;UPDATE #MPS_Position_Hourly&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;SET TotalHedgeMWh = ISNULL(ZoneHedgeMWh,0) + ISNULL(HubHedgeMWh,0),&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; TotalHedgeCost = ISNULL(ZoneHedgeCost,0) + ISNULL(HubHedgeCost,0)&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;UPDATE #MPS_Position_Hourly&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;SET NOPMWh = LoadMWh - TotalHedgeMWh&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;--8.0&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;UPDATE h&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;SET LoadMWh = LoadMWh/2,&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; ZoneHedgeMWh = ZoneHedgeMWh/2,&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; ZoneHedgeCost = ZoneHedgeCost/2,&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; HubHedgeMWh = HubHedgeMWh/2,&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; HubHedgeCost = HubHedgeCost/2,&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; TotalHedgeMWh = TotalHedgeMWh/2,&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; TotalHedgeCost = TotalHedgeCost/2,&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; NOPMWh = NOPMWh/2&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;--SELECT h.*&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;FROM #MPS_Position_Hourly h&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;JOIN [dbo].[MPS_DST_Intervals] d ON d.[Date] = h.[Date] AND d.HourEnding = h.HourEnding AND d.IntervalCount = 2&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;INSERT INTO #MPS_Position_Hourly(Company,PositionSegmentZone,ProductType,[Date],HourEnding,LoadMWh,ZoneHedgeMWh,HubHedgeMWh,ZoneHedgeCost,HubHedgeCost,TotalHedgeMWh,TotalHedgeCost,NOPMWh)&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;SELECT c.Company,c.PositionSegmentZone,c.ProductType,c.[Date],c.HourEnding,c.LoadMWh,c.ZoneHedgeMWh,c.HubHedgeMWh,c.ZoneHedgeCost,c.HubHedgeCost,c.TotalHedgeMWh,c.TotalHedgeCost,c.NOPMWh&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;FROM #MPS_Position_Hourly c&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;JOIN dbo.mps_dst_intervals d ON d.date = c.date AND d.hourending = c.hourending AND d.IntervalCount = 2&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;--9.0&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;INSERT INTO dbo.MPS_Position_Hourly(Company,PositionSegmentZone,ProductType,[Date],HourEnding,LoadMWh,ZoneHedgeMWh,HubHedgeMWh,TotalHedgeMWh,NOPMWh,Cost,CreatedDateTime)&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;SELECT Company,PositionSegmentZone,ProductType,[Date],HourEnding,ISNULL(LoadMWh,0),ZoneHedgeMWh,HubHedgeMWh,TotalHedgeMWh,NOPMWh,TotalHedgeCost,GETDATE()&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;FROM #MPS_Position_Hourly&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;order BY Company,PositionSegmentZone,ProductType,[Date],HourEnding&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;END&amp;nbsp; &amp;nbsp;&lt;/span&gt;&amp;nbsp;= s.PositionSegmentZoneID" style="text;html=1;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1"><mxGeometry x="-850" y="80" width="860.5" height="2500" as="geometry"/></mxCell><mxCell id="29jnx2Jy7FXrF2WolndV-7" value="&lt;br&gt;&lt;div style=&quot;border-color: var(--border-color); text-align: left;&quot;&gt;INSERT INTO #temp_Position_Hourly(Company,PositionSegmentZone,ProductType,[Date],HourEnding,LoadMWh)&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); text-align: left;&quot;&gt;&amp;nbsp; &amp;nbsp;SELECT l.CompanyID,a.PositionSegmentZoneID,l.ProductType,l.[Date],l.HourEnding,ISNULL(Load_MW,0)&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); text-align: left;&quot;&gt;&amp;nbsp; &amp;nbsp;FROM dbo.MPS_LoadForecastData_Interval l&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); text-align: left;&quot;&gt;&amp;nbsp; &amp;nbsp;JOIN #ListA a ON a.ProductType_ID = l.ProductType AND a.ZoneID = l.LoadZone&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); text-align: left;&quot;&gt;&amp;nbsp; &amp;nbsp;WHERE l.CompanyID = @Company&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); text-align: left;&quot;&gt;&amp;nbsp; &amp;nbsp;AND l.ProductType = @ProductType&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); text-align: left;&quot;&gt;&amp;nbsp; &amp;nbsp;AND l.LoadZone = @LoadZone&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); text-align: left;&quot;&gt;&amp;nbsp; &amp;nbsp;AND l.[Date] BETWEEN @StartDate AND @EndDate&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color); text-align: left;&quot;&gt;&amp;nbsp; &amp;nbsp;AND l.HourEnding = @HourEnding&amp;nbsp;&amp;nbsp;&lt;/div&gt;" style="text;html=1;strokeColor=#82b366;fillColor=#D5E8D4;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fillStyle=hatch;" parent="1" vertex="1"><mxGeometry x="70" y="950" width="530" height="190" as="geometry"/></mxCell></root></mxGraphModel>