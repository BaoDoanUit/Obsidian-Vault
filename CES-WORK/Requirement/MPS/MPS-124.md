


Link:: [link](https://ces-ltd.atlassian.net/browse/MPS-124)

Detail:: Remove all instance MPS assets out RETAIL01
Detail:: Move in all MPS assets to new server
Detail:: Make sure all functions run correctly

Connections Changed
- SSIS Packages
	- Data Source=USORAWASP001A;Initial Catalog=market_services;Provider=MSOLEDBSQL; Integrated Security=SSPI;AutoTranslate=False;
	- <mark style="background: #FFB86CA6;">Data Source=USORAWASP001A;Initial Catalog=msdb;Provider=MSOLEDBSQL;Integrated Security=SSPI;Application Name=SSIS-MSDB-$PackageName;Auto Translate=False;</mark>
- CES_Retail
	- <mark style="background: #FFB86CA6;">Data Source=USORAWASP001A;Initial Catalog=market_services;Provider=SQLNCLI11.1;User Id=svc.rsqljobops.dev;Password=RPivLJ6kN*#jMyGcpNhH;</mark>
- Folder FTP
	- \\cesftp01.ces.local\FTPRoot\ChariotEnergy (Verify Permission)
- Development Test 
	- Data Source=6XG71J3\SSISDEVTSQL;Initial Catalog=market_services;Provider=MSOLEDBSQL;Integrated Security=SSPI;Auto Translate=False;
	- Data Source=6XG71J3\SSISDEVTSQL;Initial Catalog=msdb;Provider=MSOLEDBSQL;Integrated Security=SSPI;Application Name=SSIS-MSDB-$PackageName;Auto Translate=False;
 
Email
- pzoting@ces-ltd.com; bao.doan@ces-ltd.com;
- pzoting@ces-ltd.com; bao.doan@ces-ltd.com;
bao.doan@ces-ltd.com; pzoting@ces-ltd.com; gsmith@ces-ltd.com; sagrawal@ces-ltd.com; aditya.jaiswal@ces-ltd.com

What the question?


Script should be prepared
- Delete all table, stored procedure, job, package SSIS

Configurations
- FTP Path File configurations?
- Connection String 'Integration Security' -> Fixed by running job via Windows Authentication

Pull Request
- Update all script in 'SSIS/TSQL Scripts/ManagementPortfolioServives'
- Preview anything before changing

Have a call with David Zhu
- Make sure all configuration had done

Link reference
- [Integration Services (SSIS) Package and Project Parameters](https://learn.microsoft.com/en-us/sql/integration-services/integration-services-ssis-package-and-project-parameters?view=sql-server-ver16)
- 

All thing change on new server
- Upgrade version SSIS package (Convert SQL Server 2022)
- Create environment and mapping to job (missing when move from RETAIL01)
- Change SQL Provider SQLNCLI11.1 -> MSOLEDBSQL
- Redeploy Stored Procedure using DatabaseName 'RETAIL' (remove retail.)



Developement
- [ ] Create new repository for MPS 
	- [ ] Move table, stored procedure script
	- [ ] Move SSIS project
	- [ ] Create folder job script

Unit Test
- [x] Run all processes MPS ✅ 2023-04-08

SSIS Toolkit
- [x] Try to integrate SFTP connection ✅ 2023-04-08
- [x] Test with new file ✅ 2023-04-08

Account SFTP
- USORAWASP001A-ChariotEnergy
- G160f0N0sf!EwzGL&


![[Pasted image 20230407110638.png]]


![[Pasted image 20230407111148.png]]

To-do-list
- [x] Deployed to my local machine ✅ 2023-04-08
- [x] Test 10 files each packages ✅ 2023-04-08
- [ ] Write instructions deploye


![[Pasted image 20230410183851.png]]
The issue is we had condition for pick up from dbo.HedgeData before modifying  dbo.MPS_HedgeData_Interval. I think we should check the data in .csv file before running job

If the record has been inserted in dbo.Hedge data has both modifiedDate and CreateDate < the max createdDateTime from table dbo.MPS_HedgeData_Interval (select max([CreatedDateTime]) from dbo.MPS_HedgeData_Interval)

```SQL
INSERT INTO #HedgeData_A([HedgeDataID],[TXNType],[Company],[TradeDate],[Trader],[Book],[Commodity],[Counterparty],[BuySell],[FinPhys],[TradeType],[DeliveryPoint],[BeginDate],[EndDate]  
 ,[BlockType],[Volume],[VolumeType],[Price],[SettlementType],[CallPut],[Strike],[StrikeFreq],[Broker],[BrokerFee],[ValidationPassed],[ValidationComment],[Imported])  
 select [HedgeDataID],[TXNType],[Company],[TradeDate],[Trader],[Book],[Commodity],[Counterparty],[BuySell],[FinPhys],[TradeType],[DeliveryPoint],[BeginDate],[EndDate]  
 ,[BlockType],[Volume],[VolumeType],[Price],[SettlementType],[CallPut],[Strike],[StrikeFreq],[Broker],[BrokerFee],[ValidationPassed],[ValidationComment],[Imported]  
 from dbo.hedgedata 
 where (CASE WHEN ISNULL(ModifiedDate,'01/01/1900') > CreateDate THEN ModifiedDate ELSE CreateDate END) > ISNULL((select max([CreatedDateTime]) from dbo.MPS_HedgeData_Interval),'01/01/1900')  
  
```

The indexes
![[Pasted image 20230410223947.png]]
![[Pasted image 20230410224142.png]]